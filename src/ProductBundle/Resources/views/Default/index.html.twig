{% extends 'base.html.twig' %}

{% block section %}
    <div class="slider-area">
        <div class="slider-active-3 owl-carousel slider-hm8 owl-dot-style">
            <!-- Slider Single Item Start -->
            <div class="slider-height-6 d-flex align-items-start justify-content-start bg-img" style="background-image: url({{ asset(image) }});">
                <div class="container">
                    <div class="slider-content-1 slider-animated-1 text-left">
                        <h1 class="animated">
                            TUNISIA DRINKS <br />
                        </h1>
                        <p class="animated">Le meilleur fournisseur alimentaire</p>
                        <a href="{{ path('AfficherProduitClient') }}" class="shop-btn animated">SHOP NOW</a>
                    </div>
                </div>
            </div>
            <!-- Slider Single Item End -->
            <!-- Slider Single Item Start -->
            <!-- Slider Single Item End -->
        </div>
    </div>
    <!-- Slider Arae End -->
    <!-- Static Area Start -->
    <section class="static-area mtb-60px">
        <div class="container">
            <div class="static-area-wrap">
                <div class="row">
                    <!-- Static Single Item Start -->
                    <div class="col-lg-3 col-xs-12 col-md-6 col-sm-6">
                        <div class="single-static pb-res-md-0 pb-res-sm-0 pb-res-xs-0">
                            <img src="assets/images/icons/static-icons-1.png" alt="" class="img-responsive" />
                            <div class="single-static-meta">
                                <h4>Livraison gratuite</h4>
                                <p>à partir de 40 dinars</p>
                            </div>
                        </div>
                    </div>
                    <!-- Static Single Item End -->
                    <!-- Static Single Item Start -->
                    <div class="col-lg-3 col-xs-12 col-md-6 col-sm-6">
                        <div class="single-static pb-res-md-0 pb-res-sm-0 pb-res-xs-0 pt-res-xs-20">
                            <img src="assets/images/icons/static-icons-2.png" alt="" class="img-responsive" />
                            <div class="single-static-meta">
                                <h4>Retours sans frais</h4>
                                <p>Les retours sont gratuits sous 9 jours</p>
                            </div>
                        </div>
                    </div>
                    <!-- Static Single Item End -->
                    <!-- Static Single Item Start -->
                    <div class="col-lg-3 col-xs-12 col-md-6 col-sm-6">
                        <div class="single-static pt-res-md-30 pb-res-sm-30 pb-res-xs-0 pt-res-xs-20">
                            <img src="assets/images/icons/static-icons-3.png" alt="" class="img-responsive" />
                            <div class="single-static-meta">
                                <h4>Paiement à la livraison</h4>
                                <p>Paiement en espèces</p>
                            </div>
                        </div>
                    </div>
                    <!-- Static Single Item End -->
                    <!-- Static Single Item Start -->
                    <div class="col-lg-3 col-xs-12 col-md-6 col-sm-6">
                        <div class="single-static pt-res-md-30 pb-res-sm-30 pt-res-xs-20">
                            <img src="assets/images/icons/static-icons-4.png" alt="" class="img-responsive" />
                            <div class="single-static-meta">
                                <h4>Support 24/7</h4>
                                <p>Contactez nous 24 heures par jour</p>
                            </div>
                        </div>
                    </div>
                    <!-- Static Single Item End -->
                </div>
            </div>
        </div>
    </section>
    <!-- Static Area End -->
    <!-- Best Sells Area Start -->
    <section class="best-sells-area mb-30px">
        <div class="container">
            <!-- Section Title Start -->
            <div class="row">
                <div class="col-md-12">
                    <div class="section-title">
                        <h2>Top Produits</h2>
                        <p>Les produits les plus vendus</p>
                    </div>
                </div>
            </div>
            <!-- Section Title End -->
            <!-- Best Sell Slider Carousel Start -->
            <div class="best-sell-slider owl-carousel owl-nav-style">
                <!-- Single Item -->
                {% for produit in topProduit|slice(0, 5)  %}

                <article class="list-product">
                    <div class="img-block">
                        <a href="single-product.html" class="thumbnail">
                            <img class="first-img" src="{{ asset(produit.0.image) }}" alt="" />
                            <img class="second-img" src="{{ asset(produit.0.image) }}" alt="" />
                        </a>
                        <div class="quick-view">
                            <a class="quick_view" href="#" data-link-action="quickview" title="Quick view" id="diale{{ produit.0.id }}" data-toggle="modal" data-target="#exampleModal">
                                <i class="ion-ios-search-strong"></i>
                            </a>
                        </div>
                    </div>


                    <div class="product-decs">
                        <a class="inner-link" href="{{ path('afficher_par_marques',{'id': produit.0.marque.id}) }}"><span>{{ produit.0.marque.titre }}</span></a>
                        <h2><a href="{{ path('afficher_par_marques',{'id': produit.0.marque.id}) }}" class="product-link">{{ produit.0.titre }}</a></h2>
                        <div class="pricing-meta">
                            <ul>
                                <li class="old-price not-cut">{{ produit.0.prix }} TND</li>

                            </ul>
                        </div>
                    </div>
                    <div class="add-to-link">
                        <ul>
                            <li class="cart"><a class="cart-btn" href="{{ path('afficher_par_marques',{'id': produit.0.marque.id}) }}">ADD TO CART </a></li>
                            <li>
                                <a href="{{ path('afficher_par_marques',{'id': produit.0.marque.id}) }}"><i class="ion-android-favorite-outline"></i></a>
                            </li>
                            <li>
                                <a href="{{ path('afficher_par_marques',{'id': produit.0.marque.id}) }}"><i class="ion-ios-shuffle-strong"></i></a>
                            </li>
                        </ul>
                    </div>
                </article>

                {% endfor %}
                <!-- Single Item -->
                <!-- Single Item -->
                <!-- Single Item -->
            </div>
            <!-- Best Sells Carousel End -->
        </div>
    </section>
    <!-- Best Sells Slider End -->

    <!-- Category Area Start -->

    <!-- Category Area End  -->
    <!-- Hot deal area Start -->

    <!-- Hot Deal Area End -->
    <!-- Banner Area Start -->

    <!-- Banner Area End -->
    <!-- Feature Area Start -->
    <section class="feature-area">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <!-- Section Title -->
                    <div class="section-title">
                        <h2>Nos produits</h2>
                    </div>
                    <!-- Section Title -->
                </div>
            </div>
            <!-- Feature Slider Start -->
            <div class="feature-slider owl-carousel owl-nav-style">
                <!-- Single Item -->
                {% for produit in produit %}
                <div class="feature-slider-item">
                    <article class="list-product">

                        <div class="img-block">
                            <a href="single-product.html" class="thumbnail">
                                <img class="first-img" src="{{ asset(produit.image) }}" alt="" />
                                <img class="second-img" src="{{ asset(produit.image) }}" alt="" />
                            </a>
                            <div class="quick-view">
                                <a class="quick_view" href="#" data-link-action="quickview" title="Quick view" id="dial{{ produit.id }}" data-toggle="modal" data-target="#exampleModal">
                                    <i class="ion-ios-search-strong"></i>
                                </a>
                            </div>
                        </div>
                        <div class="product-decs">
                            <a class="inner-link" href=""><span>{{ produit.marque.titre }}</span></a>
                            <h2><a href="" class="product-link">{{ produit.titre }}</a></h2>
                            <div class="rating-product">
                                <i class="ion-android-star"></i>
                                <i class="ion-android-star"></i>
                                <i class="ion-android-star"></i>
                                <i class="ion-android-star"></i>
                                <i class="ion-android-star"></i>
                            </div>
                            <div class="pricing-meta">
                                <ul>
                                    <li class="old-price not-cut">{{ produit.prix }} TND</li>
                                </ul>
                            </div>
                        </div>


                    </article>

                </div>
                {% endfor %}
                <!-- Single Item -->




                <!-- Single Item -->
                <!-- Single Item -->
            </div>
            <!-- Feature Slider End -->
        </div>
    </section>
    <section class="categorie-area">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <!-- Section Title -->
                    <div class="section-title mt-res-sx-30px mt-res-md-30px">
                        <h2>Marques populaires</h2>
                        <p>les marques les plus vendus</p>
                    </div>
                    <!-- Section Title -->
                </div>
            </div>
            <!-- Category Slider Start -->
            <div class="category-slider owl-carousel owl-nav-style">
                <!-- Single item -->
                {% for m in marque %}
                    <div class="category-item">
                        <div class="category-list mb-30px">
                            <div class="category-thumb">
                                <a href="{{ path('afficher_par_marques',{'id': m.id}) }}">
                                    <img src="{{ asset(m.logo) }}" alt="" height="150" width="300"/>
                                </a>
                            </div>

                        </div>
                    </div>
                {% endfor %}
                <!-- Single item -->

                <!-- Single item -->

                <!-- Single item -->
                <!-- Single item -->
            </div>
        </div>
    </section>
    <div class="banner-area-2">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="banner-inner">
                        <a href="shop-4-column.html"><img src="assets/images/banner-image/4.jpg" alt="" /></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Banner Area 2 End -->
    <!-- Recent Add Product Area Start -->
    <section class="recent-add-area">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <!-- Section Title -->
                    <div class="section-title">
                        <h2>Promotions</h2>
                    </div>
                    <!-- Section Title -->
                </div>
            </div>
            <!-- Recent Product slider Start -->
            <div class="recent-product-slider owl-carousel owl-nav-style">
                <!-- Single Item -->
                {% for promos in promotions %}
                    <article class="list-product">
                        <div class="img-block">
                            <a href="single-product.html" class="thumbnail">
                                <img class="first-img" src="{{ asset(promos.produit.image) }}" alt="" />
                                <img class="second-img" src="{{ asset(promos.produit.image) }}" alt="" />
                            </a>
                            <div class="quick-view">
                                <a class="quick_view" href="#" data-link-action="quickview" title="Quick view" id="dialf{{ promos.produit.id }}" data-toggle="modal" data-target="#exampleModal">
                                    <i class="ion-ios-search-strong"></i>
                                </a>
                            </div>
                        </div>
                        <ul class="product-flag">
                            <li class="new">Promos</li>
                        </ul>
                        <div class="product-decs">
                            <a class="inner-link" href="shop-4-column.html"><span>{{ promos.produit.marque.titre }}</span></a>
                            <h2><a href="single-product.html" class="product-link">{{ promos.produit.titre }}</a></h2>
                            <div class="rating-product">
                                <i class="ion-android-star"></i>
                                <i class="ion-android-star"></i>
                                <i class="ion-android-star"></i>
                                <i class="ion-android-star"></i>
                                <i class="ion-android-star"></i>
                            </div>
                            <div class="pricing-meta">
                                <ul>
                                    <li class="old-price">{{ promos.produit.prix }} TND</li>
                                    <li class="current-price">{{ promos.produit.prix - ((promos.produit.prix * promos.remise) / 100) }} TND</li>
                                    <li class="discount-price">{{ promos.remise }} %</li>
                                </ul>
                            </div>
                        </div>

                    </article>
                {% endfor %}
                <!-- Single Item -->

                <!-- Single Item -->
            </div>
            <!-- Recent product slider end -->
        </div>
    </section>
    <!-- Feature Area End -->
    <!-- Banner Area 2 Start -->

{% block js %}
    {% for produit in produit %}
    <div class="modal fade" id="exampleModal{{ produit.id }}" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document" id="exampleModale{{ produit.id }}">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">x</span></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-5 col-sm-12 col-xs-12">
                            <div class="tab-content quickview-big-img">
                                <div id="pro-1" class="tab-pane fade show active">
                                    <img src="{{ asset(produit.image) }}" alt="" />
                                </div>
                            </div>
                            <!-- Thumbnail Large Image End -->
                            <!-- Thumbnail Image End -->

                        </div>
                        <div class="col-md-7 col-sm-12 col-xs-12">
                            <div class="product-details-content quickview-content">
                                <h2>{{ produit.titre }}</h2>
                                <p class="reference">Marque:<span> {{ produit.marque.titre }}</span></p>
                                <p class="reference">Catégorie:<span> {{ produit.categorie.titre }}</span></p>
                                <div class="pro-details-rating-wrap">
                                    <div class="rating-product">
                                        <i class="ion-android-star"></i>
                                        <i class="ion-android-star"></i>
                                        <i class="ion-android-star"></i>
                                        <i class="ion-android-star"></i>
                                        <i class="ion-android-star"></i>
                                    </div>
                                    <span class="read-review"><a class="reviews" href="#">Read reviews (1)</a></span>
                                </div>
                                <div class="pricing-meta">
                                    <ul id="price{{ produit.id }}">
                                    </ul>
                                </div>
                                <p>{{ produit.description }}</p>
                                </div>
                                <div class="pro-details-quality">

                                    <div class="pro-details-cart btn-hover">
                                        <a href="#" id="addpanier{{ produit.id }}"> + ajouter au panier</a>
                                    </div>
                                </div>
                                <div class="pro-details-wish-com">
                                    <div class="pro-details-wishlist">
                                        <a href="#"><i class="ion-android-favorite-outline"></i>Add to wishlist</a>
                                    </div>
                                    <div class="pro-details-compare">
                                        <a href="#"><i class="ion-ios-shuffle-strong"></i>Add to compare</a>
                                    </div>
                                </div>
                                <div class="pro-details-social-info">
                                    <span>Share</span>
                                    <div class="social-info">
                                        <ul>
                                            <li>
                                                <a href="#"><i class="ion-social-facebook"></i></a>
                                            </li>
                                            <li>
                                                <a href="#"><i class="ion-social-twitter"></i></a>
                                            </li>
                                            <li>
                                                <a href="#"><i class="ion-social-google"></i></a>
                                            </li>
                                            <li>
                                                <a href="#"><i class="ion-social-instagram"></i></a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <script>
            {% if is_granted('IS_AUTHENTICATED_REMEMBERED') %}
            var commande = localStorage.getItem("commande");

            if(commande){
                var r = confirm("voulez vous enregistrer votre adresse de livraison ?");
                if (r == true) {
                    window.location.href = "/livraison/"+commande.toString();
                } else {
                    txt = "You pressed Cancel!";
                }

            }
            {% endif %}
            var data = localStorage.getItem("panier");
            var panier = [] ;
            var prix = 0 ;
            var livraison = 0;
            var prix_total = 0
            if(data){
                var obj = jQuery.parseJSON(data);
                for(i=0; i< obj.length ; i++){
                    panier.push(obj[i])
                    prix = prix+ parseInt(obj[i].prix)
                }
                if(prix < 40){
                    livraison = 7 ;
                }
                prix_total = prix+livraison
                $("#vam").html('<div id="vam"><a href="#" class="count-cart" ><span>'+prix_total+' TND</span></a></div>')
            }

            $("#dial{{ produit.id }}").click(function () {
                $("#price{{ produit.id }}").empty();
                $("#price{{ produit.id }}").append('<li class="old-price not-cut">{{produit.prix}} TND</li>');


                $('#exampleModal{{ produit.id }}').modal('toggle');
            })
            $("#diale{{ produit.id }}").click(function () {
                $.post('{{ path('checkPromotio',{'id':produit.id}) }}',JSON.stringify(data),function (mes) {
                    /**localStorage.setItem('commande', mes.toString());
                     window.setTimeout(function(){
                        window.location.href = "/livraison/"+mes.toString()
                    }, 1500);**/
                    if(mes["promotion"]){
                    var remise = parseInt(mes["promotion"][0]["remise"]);
                    var price = parseFloat({{ produit.prix }});
                    var newPrice = (price -((price * remise)/ 100))

                        $("#price{{ produit.id }}").empty();



                        $("#price{{ produit.id }}").append('<li class="old-price">{{ produit.prix }} TND</li>'+
                        '<li class="current-price" >'+newPrice+' TND</li>'+
                        '<li class="discount-price">'+remise+' %</li>'+
                        '<input type="text" value="'+newPrice+'" id="newPrice{{ produit.id }}" hidden>');


                    }
            else{
                        $("#price{{ produit.id }}").empty();
                        $("#price{{ produit.id }}").append('<li class="old-price not-cut">{{produit.prix}} TND</li>');
                    }

                })
                $('#exampleModal{{ produit.id }}').modal('toggle');
            })
            $("#dialf{{ produit.id }}").click(function () {
                $.post('{{ path('checkPromotio',{'id':produit.id}) }}',JSON.stringify(data),function (mes) {
                    /**localStorage.setItem('commande', mes.toString());
                     window.setTimeout(function(){
                        window.location.href = "/livraison/"+mes.toString()
                    }, 1500);**/
                    console.log(mes["promotion"][0]["remise"])
                    var remise = parseInt(mes["promotion"][0]["remise"]);
                    var price = parseFloat({{ produit.prix }});
                    var newPrice = (price -((price * remise)/ 100))
                    if(mes["promotion"][0]["remise"]){
                        $("#price{{ produit.id }}").empty();



                        $("#price{{ produit.id }}").append('<li class="old-price">{{ produit.prix }} TND</li>'+
                            '<li class="current-price">'+newPrice+' TND</li>'+
                            '<li class="discount-price">'+remise+' %</li>');
                    }

                })
                $('#exampleModal{{ produit.id }}').modal('toggle');
            })
            $("#addpanier{{ produit.id }}").click(function () {
                var pr = $("#newPrice{{ produit.id }}").val();

                if(pr){
                    alert(pr)
                    var monobjet  = {
                        titre : "{{ produit.titre }}",
                        description : "{{ produit.description }}",
                        image : "{{ produit.image }}",
                        prix : parseFloat(pr),
                        quantite : 1,
                        id : {{ produit.id }}
                    };
                    prix_total = parseFloat(pr) + prix_total
                }
                else{
                    var monobjet  = {
                        titre : "{{ produit.titre }}",
                        description : "{{ produit.description }}",
                        image : "{{ produit.image }}",
                        prix : "{{ produit.prix }}",
                        quantite : 1,
                        id : {{ produit.id }}
                    };
                    prix_total = parseFloat("{{ produit.prix }}") + prix_total
                }
                panier.push(monobjet);
                var monobjet_json = JSON.stringify(panier);
                localStorage.setItem('panier', monobjet_json);
                $("#vam").html('<div id="vam"><a href="#" class="count-cart" ><span>'+prix_total+' TND</span></a></div>')
                var obj = jQuery.parseJSON(monobjet_json);
                for(i=0; i< obj.length ; i++){
                    prixTotal = prixTotal + parseFloat(obj[i].prix)
                    $('#pan').append('<li class="single-shopping-cart">'+
                        '<div class="shopping-cart-img">'+
                        '<a href=""><img alt="" src="'+obj[i].image+'" /></a>'+
                        '<span class="product-quantity">'+obj[i].quantite+'</span>'+
                        '</div>'+
                        ' <div class="shopping-cart-title">'+
                        '<h4><a href="">'+obj[i].titre+'</a></h4>'+
                        '<span>'+obj[i].prix+'</span>'+
                        ' <div class="shopping-cart-delete">'+
                        '<a href="#"><i class="ion-android-cancel"></i></a>'+
                        '</div>'+
                        '</div>'+
                        '</li>')
                }
                total  = livraison + prixTotal
                $('#price').append('<div class="shopping-cart-total">'+
                    '<h4>Prix : <span>'+prixTotal+ ' TND'+'</span></h4>'+
                    '<h4>Livraison : <span>'+livraison+' TND'+'</span></h4>'+
                    '<h4 class="shop-total">Total : <span>'+total+' TND'+'</span></h4>'+
                    '</div>'+
                    '<div class="shopping-cart-btn text-center">'+
                    '<a class="default-btn" href="{{ path('cart') }}" id="clickPanier">checkout</a>'+
                    '</div>')
                $("#addpanier{{ produit.id }}").hide();

            })
        </script>

    {% endfor %}
    <!-- Recent product area end -->
    <!-- Brand area start -->
{% endblock %}

{% endblock %}
{% block marques %}
    {% for m in marque %}
        <li class="menu-dropdown">
            <a href="{{ path('afficher_par_marques',{'id': m.id}) }}" >{{ m.titre }}</a>
        </li>
    {% endfor %}
{% endblock %}
{% block categories %}
    {% for m in categorie %}
        <li class="menu-dropdown">
            <a href="{{ path('afficher_par_categories',{'id': m.id}) }}" >{{ m.titre }}</a>
        </li>
    {% endfor %}
{% endblock %}
